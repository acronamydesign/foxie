//Purpose: Building up some data about working/installed foxie subcores.
//Exec type: Sync

var api = require("foxie-api"),
		colors = require("colors"),
		api = {
			mainPath:api.path.mainPath,
			arrDif:api.data.arrDif,
			saveData:api.data.extend
		}

var mainPackage = require(api.mainPath("foxie")+"/package.json"),
		mainModules = mainPackage.dependencies,
		mainModules = Object.keys(mainModules)

for(m in mainModules){
	if(!/foxie-/.test(mainModules[m])) delete mainModules[m];
}
mainModules.filter(Boolean)

var enabledFoxieCores = []

for(m in mainModules){
	try{
		if(require.resolve(mainModules[m])) enabledFoxieCores[m] = mainModules[m];
	}
	catch(err){
		console.log(colors.red("[warning] "+ mainModules[m] + " has not been installed correctly. is this module added to the main package.json or does it have an entry point file that exists?"))

	}
}
var enabledFoxieCores = enabledFoxieCores.filter(Boolean),
		dormentFoxieCores = api.arrDif(mainModules,enabledFoxieCores);

//push stats to data
api.saveData("subcores","ready",enabledFoxieCores)
api.saveData("subcores","dormant",dormentFoxieCores)
