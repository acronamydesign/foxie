var data = require("foxie-data"),
		init = data.subcores.ready,
		path = require("path"),
		colors = require("colors"),
		api = require("foxie-api"),
		api = {
			saveData:api.data.extend
		},
		adminMenuItems = []

//TEMP
var schema = require("js-schema")

var pluginSchema = {
	root:schema({
		plugin:Object
	}),
	menuKey:schema({
		admin:Boolean,
		title:String,
		url:String,
		icon:String
	}),
	uiKey:schema({
		template:Boolean,
		title:String,
		description:String,
		data:Boolean,
		models:Boolean
	}),
	load:schema({
		data:Boolean,
		models:Boolean
	})
}

for(subcore in init){
	var foxiePluginPathJson = path.resolve(require.resolve(init[subcore]),"../package.json")
	var requiredPluginJson = require(foxiePluginPathJson),
			hasFoxieKey = requiredPluginJson.foxie,
			foxieKey = hasFoxieKey
	if(hasFoxieKey){
		if(!pluginSchema.root(foxieKey)&&!pluginSchema.menuKey(foxieKey.plugin.menu)&&!pluginSchema.uiKey(foxieKey.plugin.ui)){
			console.log(colors.yellow("[Warn] "+requiredPluginJson.name+"'s Package json has a problem with its foxie key"))
		}
		else{
			//do stuff with present data
			if(foxieKey.plugin.menu){
				adminMenuItems.push({
					title:foxieKey.plugin.menu.title,
					url:foxieKey.plugin.menu.url,
					icon:foxieKey.plugin.menu.icon,
				})
			}
			if(foxieKey.plugin.load){
				if(foxieKey.plugin.load.data){
					try{
						require(path.resolve(require.resolve(init[subcore]),"../schema/data-model/install.data.js"))
					}
					catch(err){
						if(err) console.log("if foxies data key is true "+requiredPluginJson.name+" please ensure you have added the following files and folders ./schema/data-model/install.data.js")
						if(err) console.log(err)
					}
				}
				if(foxieKey.plugin.load.models){
					api.saveData("models",init[subcore],path.resolve(require.resolve(init[subcore]),"../schema/db-model"))
				}
			}
		}
	}
	require(init[subcore])
}

api.saveData("view_common","admin_menu",adminMenuItems)
