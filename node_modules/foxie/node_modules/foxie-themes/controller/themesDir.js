var data = require("foxie-data"),
		fs = require("fs"),
		promise = require("bluebird"),
		colors = require("colors"),
		api = require("foxie-api"),
		api = {
			saveData:api.data.extend
		}

//set the conf file convention
api.saveData("themes","conf_file","settings.js")

promise.promisifyAll(fs);

function writeFile(path,content,coding){
	fs.writeFileAsync(path,content,coding)
	.then(function(){
		console.log(colors.magenta("writing files for themes in directory: "+path))
	})
	.catch(function(err){
		console.log(err)
	})
}

function writeDir(path){
	fs.mkdirAsync(path)
	.then(function(){
		console.log(colors.magenta("Installing themes directory at: "+path))
	})
	.catch(function(err){
		console.log(err)
	})
}

function parseTheme(){
	require("./allThemes.js")
}

function defaultThemes(){
	//set the conf file convention
	writeFile(data.public.themes+"/"+data.themes.default[0]+"/"+data.themes.conf_file,"")
	writeFile(data.public.themes+"/"+data.themes.default[1]+"/"+data.themes.conf_file,"")
	parseTheme()
}

fs.readdirAsync(data.public.themes)
.then(function(res){
	if(res.length>0){ //no themes yet
		parseTheme()
	}
}).catch(function(err){
	writeDir(data.public.path)
	writeDir(data.public.themes)
	defaultThemes()
})
