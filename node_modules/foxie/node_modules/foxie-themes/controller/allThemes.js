var data = require("foxie-data"),
		fs = require("fs"),
		promise = require("bluebird"),
		colors = require("colors"),
		api = require("foxie-api"),
		api = {
			saveData:api.data.extend
		}

promise.promisifyAll(fs);


//validate and catagorise a file as dormant or ready
fs.readdirAsync(data.public.themes)
.then(function(res){

	var dormant = [],
			ready = [],
			all = res,
			themePath = [],
			count = 0

	for(t in all){
		themePath.push(data.public.themes+"/"+all[t])
	}
	for(t in themePath){
		fs.readdirAsync(themePath[t])
		.then(function(res){
			if(res.indexOf("settings.js") == parseInt(-1)){
				data.themes.dormant.push(all[count++])
				throw new Error(colors.red('A theme folder must contain a "'+data.themes.conf_file+'" please chack foxie-data for details'));
			}
			else if(res.indexOf("package.json") == parseInt(-1)){
				data.themes.dormant.push(all[count++])
				throw new Error(colors.red('A theme folder must contain a "package.json" file please chack foxie-data for details'));
			}
			else{
				data.themes.ready.push(all[count++])
			}
		})
		.catch(function(err){
			if(err) console.log(err)
		})
		.done(function(){
			require("./saveThemeData.js")
		})
	}
	//api.saveData("themes","ready",res)
	//console.log(data)
})
