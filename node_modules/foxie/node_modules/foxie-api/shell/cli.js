#!/usr/bin/env node
var colors = require('colors/safe'),
		$ = require('./register.js'),
		parseMeta = require("./actions/parseMeta.js")

var helpCall = {
	short:new RegExp("-h"),
	full:new RegExp("--help")
}

function help($,proc,message){
	require("./help.js")($,proc,message)
}
function validation(test){
	for(command in $){
		if(command == test){
			 return true
		}
	}
}

var mainProc = process.argv[2];//main process
var subProc = process.argv[3]; //sub process or help


if(validation(mainProc)){ //check if a valid command

	//if sub proc is valid run the class of that file
	if(Object.keys($[mainProc].method).indexOf(subProc) != "-1"){
		require($[mainProc].execPath)[subProc]()
	}
	//if valid but help flag called
	else if(helpCall.short.test(subProc)||helpCall.full.test(subProc)){
		help($,mainProc,null)
	}
	//if sub proc is invalid you need help so we will return to root help
	else{
		help($,null,"Warning "+ subProc +" is an invalid subcommand of "+mainProc)
	}
}

else{//Help was called or namespace was blank
	if(mainProc == "-h" || mainProc == "--help" || !mainProc){
		help($,null,null)
	}
	else{//Unrecognised main proc
		help($,null,"Warning "+ mainProc +" is not a valid command")
	}
}

